# 周1：需求 / 架构 / 基础设施（工作日计划）

- 周一：范围确认，MVP 冻结；角色/权限矩阵定稿。
  - 冻结的 MVP 范围：
    - 上传解析（零原文件存储，解析/提取/清理）
    - Skill（生成/版本/标签/引用）
    - 功能创建（运行时选择、IO 定义、依赖、测试）
    - 发布固化（发布即固化，版本化，需审核）
    - 调用（REST/WebSocket/SSE，同步/异步）
    - 权限/审核（角色矩阵，功能/Skill 发布与变更审核，审计日志）
    - 运行监控（运行时池、任务队列、耗时/错误率、告警）
    - 成本面板（调用/成本趋势，配额预警，模型/功能/团队拆分）
  - 合理性结论：MVP 范围闭环且合理，覆盖从数据进入到功能上线与运营的核心链路，凸显“零原文件存储 + 功能固化 + 多运行时”。
  - 注意事项（执行深度控制）：
    - 监控/成本面板：先做最低可行版本（运行时池健康、队列长度、调用量/错误率、基础成本汇总），避免过早做复杂报表。
    - 权限/审核边界：先聚焦功能/Skill 的发布、修改、下架审核和调用权限，暂缓更细粒度的数据域控制，后续迭代。
- 周二：技术栈与多运行时方案定稿；仓库/分支策略确定。
  - 技术栈确认：
    - 前端：React + TypeScript（Vue + TS 备用）
    - 后端主中台：Node.js 优先（Python 次选，Java 备选）
    - 多运行时：Python / Node / Java（容器化）
    - 容器/编排：Docker + Kubernetes（本地/PoC 用 Compose）
    - 队列：Kafka 默认，RabbitMQ 备选
    - 数据库：PostgreSQL + Redis
    - 对象存储：默认零原文件，临时内存/本地+定时清理；如需缓存/元数据可接 S3 兼容
  - 多运行时方案定稿（镜像/配额/预热）：
    - 镜像：python:3.11-alpine / node:18-alpine / eclipse-temurin:17-jre-alpine，非 root，时区/证书同步，预装常用库，包管理缓存
    - 默认配额：Python 1c/512MB/60s，并发1；Node 1c/512MB/60s，并发1；Java 1c/1GB/90s，并发1
    - 预热与冷启动：各语言预热 2-3 容器，冷启动命中目标 < 2s，队列/CPU/延迟驱动扩缩，空闲回收，健康检查
    - 安全基线：只读 FS + 临时目录，外网白名单，非 root，统一错误与敏感信息过滤
  - 仓库/分支策略：
    - main 受保护，feature 分支开发，PR+CR 必须
    - CI 阶段：lint/test/build；容器构建与推送
    - 约定提交规范与版本号策略（功能发布=固化需版本化）
  - 合理性结论：方案可支撑“多运行时 + 零原文件 + 容器化”目标，技术栈与流程匹配。
  - 可选微调（非必须）：
    - 监控基线：CI 对镜像体积、构建时长设置阈值；运行时镜像定期安全扫描。
    - 依赖锁定/审计：npm/yarn/pip/gradle 依赖锁定与白名单/审计。
    - 配额分环境：dev 更低，prod 稍高；超时与内存上限写入配置中心。
- 周三：CI/CD 框架（lint/test/build），容器仓库配置。
  - CI：前后端/执行引擎仓库的 lint/test/build pipeline 草稿
  - 容器：构建脚本、镜像命名规范、推送到私有/公共仓库
  - 保护：main 分支保护规则，PR 必须通过 CI
  - 环境变量：.env.example 与密钥占位，区分 dev/stage/prod
- 周四：运行时基础镜像（Py/Node/Java）制作，预热脚本；K8s/Compose 雏形。
  - 制作并验证三种基础镜像（体积、启动时长、预装库）
  - 预热脚本：按语言拉起 2-3 容器，健康检查
  - K8s/Compose：本地 PoC 模板（API 网关、主后端、调度器、运行时池、DB、Redis、MQ）
- 周五：零存储策略、日志脱敏、密钥管理、安全基线文档。
  - 零原文件策略：上传→解析→提取→清理的中间件/管线设计
  - 日志脱敏：过滤规则与日志格式
  - 密钥管理：企业/个人密钥存储策略、轮换流程
  - 安全基线文档：网络白名单、非 root、只读 FS、超时/内存限制、审计日志要求

